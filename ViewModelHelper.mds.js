function viewmodelhelper_mds() { "use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _get(){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=_superPropBase(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},_get.apply(this,arguments)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_setPrototypeOf(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){if(t&&("object"===_typeof(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_getPrototypeOf(e)}function _regeneratorRuntime(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */_regeneratorRuntime=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var a=t&&t.prototype instanceof _?t:_,o=Object.create(a.prototype),s=new P(r||[]);return i(o,"_invoke",{value:S(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",f="suspendedYield",p="executing",v="completed",g={};function _(){}function m(){}function w(){}var C={};c(C,o,(function(){return this}));var b=Object.getPrototypeOf,I=b&&b(b(j([])));I&&I!==n&&r.call(I,o)&&(C=I);var x=w.prototype=_.prototype=Object.create(C);function y(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,a,o,s){var u=h(e[i],e,a);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==_typeof(l)&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(l).then((function(e){c.value=e,o(c)}),(function(e){return n("throw",e,o,s)}))}s(u.arg)}var a;i(this,"_invoke",{value:function(e,r){function i(){return new t((function(t,i){n(e,r,t,i)}))}return a=a?a.then(i,i):i()}})}function S(t,n,r){var i=d;return function(a,o){if(i===p)throw new Error("Generator is already running");if(i===v){if("throw"===a)throw o;return{value:e,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var u=V(s,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=v,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=p;var c=h(t,n,r);if("normal"===c.type){if(i=r.done?v:f,c.arg===g)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(i=v,r.method="throw",r.arg=c.arg)}}}function V(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,V(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=h(i,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var o=a.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function R(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(R,this),this.reset(!0)}function j(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw new TypeError(_typeof(t)+" is not iterable")}return m.prototype=w,i(x,"constructor",{value:w,configurable:!0}),i(w,"constructor",{value:m,configurable:!0}),m.displayName=c(w,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,u,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},y(k.prototype),c(k.prototype,s,(function(){return this})),t.AsyncIterator=k,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new k(l(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(x),c(x,u,"Generator"),c(x,o,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=j,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(O),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var u=r.call(o,"catchLoc"),c=r.call(o,"finallyLoc");if(u&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),O(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;O(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:j(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},t}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"===_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var __awaiter=window.__awaiter=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(e){a(e)}}function s(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))};ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ItemState",[],(function(e,t){t&&t.id;return{setters:[],execute:function(){e("ItemState",_createClass((function e(t,n,r,i){_classCallCheck(this,e),this.control=t,this.settings=n,this.d=r,this.messagePanel=i}))),e("ItemStateControl",_createClass((function e(t,n,r,i,a){_classCallCheck(this,e),this.container=t,this.service=n,this.startLoading=r.startLoading,this.endLoading=r.endLoading,this.loadingId=r.loadingId,this.show=i.show,this.hide=i.hide,this.isError=a})))}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ItemHelper",[],(function(e,t){t&&t.id;return{setters:[],execute:function(){e("ItemHelper",function(){function e(t){var n=this;_classCallCheck(this,e),this._getDataOnInit=!0,this._getDataOnInitNotConnectedTo=[],this._getDataOnInitConditions=[],this.init=function(){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._getDataOnInit&&this._initialAction&&this._initialAction.action)){e.next=19;break}if(!(this._getDataOnInitNotConnectedTo.length>0)){e.next=9;break}t=0;case 3:if(!(t<this._getDataOnInitNotConnectedTo.length)){e.next=9;break}if(!ChipSoft.ClientConnectionManager.getConnectionProviderId(this._state.control.container.requestInfo.componentId,this._getDataOnInitNotConnectedTo[t])){e.next=6;break}return e.abrupt("return");case 6:t++,e.next=3;break;case 9:if(!(this._getDataOnInitConditions.length>0)){e.next=17;break}n=0;case 11:if(!(n<this._getDataOnInitConditions.length)){e.next=17;break}if(this._getDataOnInitConditions[n]()){e.next=14;break}return e.abrupt("return");case 14:n++,e.next=11;break;case 17:return e.next=19,this.updateInternal(this._initialAction.action,this._initialAction.viewData,this._initialAction.dataCallback);case 19:case"end":return e.stop()}}),e,this)})))},this.refresh=function(){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.refreshInternal());case 1:case"end":return e.stop()}}),e,this)})))},this.update=function(e,t,r){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.updateInternal(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))},this.clear=function(){n.clearInternal()},this.updateCommand=function(e,t,r){return function(i,a,o,s){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){n.next=4;break}return i=s.objectId,n.next=4,this.updateInternal((function(t){return e(t,i)}),t,r);case 4:case"end":return n.stop()}}),n,this)})))}},this._state=t}return _createClass(e,[{key:"autoRefreshTimeout",get:function(){return this._autoRefreshTimeout},set:function(e){this._autoRefreshTimeout=e}},{key:"getDataOnInit",get:function(){return this._getDataOnInit},set:function(e){this._getDataOnInit=e}},{key:"getDataOnInitNotConnectedTo",get:function(){return this._getDataOnInitNotConnectedTo}},{key:"getDataOnInitConditions",get:function(){return this._getDataOnInitConditions}},{key:"modelCreator",get:function(){return this._modelCreator},set:function(e){this._modelCreator=e}},{key:"liveValueProviders",get:function(){return this._liveValueProviders||(this._liveValueProviders=new ChipSoft.Core.LiveValueProviders),this._liveValueProviders}},{key:"updateWithObjectId",value:function(e,t,n){var r=this;return function(i){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.updateInternal((function(t){return e(t,i)}),t,n));case 1:case"end":return r.stop()}}),r,this)})))}}},{key:"setInitialAction",value:function(e,t,n){this._initialAction={action:e,viewData:t,dataCallback:n}}},{key:"setRefreshAction",value:function(e,t,n){this._refreshActionCallback={action:e,viewData:t,dataCallback:n}}},{key:"dispose",value:function(){this._autoRefreshTimer&&clearTimeout(this._autoRefreshTimer)}},{key:"refreshInternal",value:function(e){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this._refreshActionCallback)){t.next=4;break}return t.next=4,this.updateInternal(n.action,n.viewData,n.dataCallback,e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"updateInternal",value:function(e,t,n,r){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,o,s,u,c,l,h,d=this;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=this._lastAction="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),this._state.control.isError(!1),!1!==(null==r?void 0:r.showLoader)&&this._state.control.startLoading(this._state.control.loadingId),this._state.messagePanel.isVisible(!1),this._autoRefreshTimer&&clearTimeout(this._autoRefreshTimer),i.prev=5,i.next=8,e(this._state.control.service);case 8:if(o=i.sent,a===this._lastAction){i.next=12;break}return ChipSoft.PageManager.logVerbose("componentActionRequest ".concat(a," is superseded by ").concat(this._lastAction)),i.abrupt("return",!1);case 12:if(!n){i.next=17;break}if(!(s=n(o))){i.next=17;break}return i.next=17,s;case 17:(u=t(o))&&u.data&&u.data.hasOwnProperty("ObjectId")?(c=ChipSoft.Core.itemViewModelCreator(this._state.settings.viewSettings),l=ChipSoft.Core.createViewDataModel(u,this._state.control.container,(function(e){c(e),d._modelCreator&&d._modelCreator(e)}),this._liveValueProviders),this._state.d(l),h=!1,this._state.settings.viewSettings&&"HideView"===this._state.settings.viewSettings.noDataPolicy&&!0===l.viewResult.attr[ChipSoft.Views.ViewResultNodeAttributes.empty]&&(this._state.settings.viewSettings.noDataText||(h=!0)),h?this._state.control.hide():this._state.control.show()):this.clearInternal(),i.next=25;break;case 21:i.prev=21,i.t0=i.catch(5),ChipSoft.PageManager.logError(i.t0),this._state.control.isError(!0);case 25:return!1!==(null==r?void 0:r.showLoader)&&this._state.control.endLoading(this._state.control.loadingId),this.autoRefreshTimeout&&(this._autoRefreshTimer=setTimeout((function(){d.refreshInternal({showLoader:!1})}),this.autoRefreshTimeout)),i.abrupt("return",!1);case 28:case"end":return i.stop()}}),i,this,[[5,21]])})))}},{key:"clearInternal",value:function(){this._state.d(ChipSoft.Core.createEmptyItemViewDataModel(this._state.control.container,this._state.settings.viewSettings));var e=!1;this._state.settings.viewSettings&&"HideView"===this._state.settings.viewSettings.noDataPolicy&&(this._state.settings.viewSettings.noDataText||(e=!0)),e?this._state.control.hide():this._state.control.show()}}]),e}())}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ItemUpdateState",[],(function(e,t){t&&t.id;return{setters:[],execute:function(){e("ItemUpdateState",_createClass((function e(t,n,r,i,a,o,s,u,c){_classCallCheck(this,e),this.control=t,this.settings=n,this.d=r,this.messagePanel=i,this.postResultMessage=a,this.postStatus=o,this.postSuccessMessage=s,this.postResultMessageShow=u,this.hideViewOnSuccessfulPost=c}))),e("ItemUpdateStateControl",_createClass((function e(t,n,r,i,a){_classCallCheck(this,e),this.container=t,this.service=n,this.startLoading=r.startLoading,this.endLoading=r.endLoading,this.loadingId=r.loadingId,this.show=i.show,this.hide=i.hide,this.isError=a})))}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ItemUpdateHelper",[],(function(e,t){var n,r,i,a;t&&t.id;return{setters:[],execute:function(){!function(e){e[e.None=0]="None",e[e.NewObject=1]="NewObject",e[e.EditObject=2]="EditObject"}(n||(n={})),r=_createClass((function e(){_classCallCheck(this,e),this.fields={}})),a=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.apply(this,arguments)).fields={},e}return _createClass(n)}(i=_createClass((function e(){_classCallCheck(this,e)}))),e("ItemUpdateHelper",function(){function e(t){var r=this;_classCallCheck(this,e),this._getDataOnInit=!0,this._getDataOnInitNotConnectedTo=[],this._getDataOnInitConditions=[],this.init=function(){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._getDataOnInit&&this._initialAction&&this._initialAction.action)){e.next=19;break}if(!(this._getDataOnInitNotConnectedTo.length>0)){e.next=9;break}t=0;case 3:if(!(t<this._getDataOnInitNotConnectedTo.length)){e.next=9;break}if(!ChipSoft.ClientConnectionManager.getConnectionProviderId(this._state.control.container.requestInfo.componentId,this._getDataOnInitNotConnectedTo[t])){e.next=6;break}return e.abrupt("return");case 6:t++,e.next=3;break;case 9:if(!(this._getDataOnInitConditions.length>0)){e.next=17;break}n=0;case 11:if(!(n<this._getDataOnInitConditions.length)){e.next=17;break}if(this._getDataOnInitConditions[n]()){e.next=14;break}return e.abrupt("return");case 14:n++,e.next=11;break;case 17:return e.next=19,this.updateInternal(this._initialAction.action,this._initialAction.viewData,this._initialAction.dataCallback);case 19:case"end":return e.stop()}}),e,this)})))},this.refresh=function(){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.refreshInternal());case 1:case"end":return e.stop()}}),e,this)})))},this.update=function(e,t,n){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.updateInternal(e,t,n));case 1:case"end":return r.stop()}}),r,this)})))},this.clear=function(){r.clearInternal()},this.save=function(){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._saveActionCallback)){e.next=4;break}return e.next=4,this.saveInternal(t.action,t.viewData,t.dataCallback);case 4:case"end":return e.stop()}}),e,this)})))},this.saveWithAction=function(e,t,n){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.saveInternal(e,t,n));case 1:case"end":return r.stop()}}),r,this)})))},this.updateCommand=function(e,t,n){return function(i,a,o,s){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){var i;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){r.next=4;break}return i=s.objectId,r.next=4,this.updateInternal((function(t){return e(t,i)}),t,n);case 4:case"end":return r.stop()}}),r,this)})))}},this.saveCommand=function(){return function(e,t,n,i){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._saveActionCallback)){e.next=4;break}return e.next=4,this.saveInternal(t.action,t.viewData,t.dataCallback);case 4:case"end":return e.stop()}}),e,this)})))}},this.saveWithActionCommand=function(e,t,n){return function(i,a,o,s){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){var i;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){r.next=4;break}return i=s.objectId,r.next=4,this.saveInternal((function(t,n){return e(t,n,i)}),t,n);case 4:case"end":return r.stop()}}),r,this)})))}},this.getPostValues=function(){if(!r._metadata)return null;var e={ClassId:r._metadata.objectId.ClassId,Mode:"None",Fields:{IgnoreCase:!0,Items:[]}};r._metadata.mode===n.EditObject?e.Mode="EditObject":r._metadata.mode===n.NewObject&&(e.Mode="NewObject");var t=r._state.d();if(t.viewResult&&1===t.viewResult.item.length)for(var i=t.viewResult.item[0],o=0;o<t.viewFields.fieldRef.length;o++){var s=t.viewFields.fieldRef[o],u=i.fields[s.attr[ChipSoft.Views.FieldRefNodeAttributes.name_]];if(u){var c=r.getFieldPathFrom(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.fieldPath]),l=!0===u.attr[ChipSoft.Views.ItemFieldNodeAttributes.editable],h=u.attr[ChipSoft.Views.ItemFieldNodeAttributes.type_];if(c.isHiXFieldPath&&l){var d=c.fieldPath.split("."),f=d[d.length-1];if("Date"===h)r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:ChipSoft.Core.dateValueFromInput(ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.dateInputValue]))});else if("Time"===h)r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:ChipSoft.Core.timeValueFromInput(ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.timeInputValue]))});else if("DateTime"===h)r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:ChipSoft.Core.dateTimeValueFromInput(ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.dateInputValue]),ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.timeInputValue]))});else if("Boolean"===h){var p=ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.inputValue]);r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:"true"===p})}else if("Integer"===h||"Integer64"===h){var v=ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.integerInputValue])||"",g=parseInt(v,10);g=isNaN(g)?null:g,r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:g})}else if("Float"===h){var _=ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.integerInputValue])||"",m=ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.decimalInputValue])||"",w=parseFloat(_+"."+m);w=isNaN(w)?null:w,r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:w})}else if("String"===h||"Memo"===h||"ImageUrl"===h)r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:h,Value:ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.inputValue])});else if("Object"===h){var C=ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.inputValue]),b="hixobjref:";if(C&&C.key&&0===C.key.indexOf(b)){var I=JSON.parse(C.key.substring(10));r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:"ObjectId",Value:I})}else{var x=r.getMetadataField(r._metadata,c.fieldPath);x instanceof a&&x.objectId&&x.objectId.ClassId&&r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:"ObjectId",Value:null})}}else if("Collection"===h){var y=ko.unwrap(u.attr[ChipSoft.Views.ItemFieldNodeAttributes.inputValue]);if(y&&y.length>0){for(var k={ClassId:"",Items:[],Locked:!0},S=null,V=0;V<y.length;V++){var R=y[V],O="hixobjref:";if(R&&R.key&&0===R.key.indexOf(O)){var P=JSON.parse(R.key.substring(10));k.Items.push(P),null===S?S=P.ClassId:S!==P.ClassId&&(S="")}}k.ClassId=S,r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:"CollectionReference",Value:k})}else{var j=r.getMetadataField(r._metadata,c.fieldPath);j instanceof a&&j.objectId&&j.objectId.ClassId&&r.storeValue(e,r._metadata,c.fieldPath,{Name:f,ValueType:"CollectionReference",Value:null})}}}}}return e},this.updateInternal=function(e,t,n){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){var i,a,o,s,u,c,l,h,d,f=this;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=this._lastAction="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),this._state.control.isError(!1),this._state.control.startLoading(this._state.control.loadingId),r.prev=3,r.next=6,e(this._state.control.service);case 6:if(a=r.sent,i===this._lastAction){r.next=10;break}return ChipSoft.PageManager.logVerbose("componentActionRequest ".concat(i," is superseded by ").concat(this._lastAction)),r.abrupt("return",!1);case 10:if(!n){r.next=15;break}if(!(o=n(a))){r.next=15;break}return r.next=15,o;case 15:(s=t(a))&&s.data&&s.data.hasOwnProperty("ObjectId")?(u=ChipSoft.Core.itemViewModelCreator(this._state.settings.viewSettings),c=ChipSoft.Core.createViewDataModel(s,this._state.control.container,(function(e){u(e),f._modelCreator&&f._modelCreator(e)}),this._liveValueProviders),this._state.d(c),this._metadata=this.createMetadata(s),l=s.message||"",h=s.status||"Success",this._state.postResultMessage(l),this._state.postStatus(h),d=!1,this._state.settings.viewSettings&&"HideView"===this._state.settings.viewSettings.noDataPolicy&&!0===c.viewResult.attr[ChipSoft.Views.ViewResultNodeAttributes.empty]&&(this._state.settings.viewSettings.noDataText||(d=!0)),d?this._state.control.hide():this._state.control.show()):this.clearInternal(),this._state.messagePanel.isVisible(!1),this._state.control.endLoading(this._state.control.loadingId),r.next=25;break;case 21:r.prev=21,r.t0=r.catch(3),ChipSoft.PageManager.logError(r.t0),this._state.control.isError(!0);case 25:return r.abrupt("return",!1);case 26:case"end":return r.stop()}}),r,this,[[3,21]])})))},this.saveInternal=function(e,t,n){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){var i,a,o,s,u,c=this;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return this._state.control.isError(!1),this._state.control.startLoading(this._state.control.loadingId),i=this.getPostValues(),r.prev=3,r.next=6,e(this._state.control.service,i);case 6:if(a=r.sent,!n){r.next=12;break}if(!(o=n(a))){r.next=12;break}return r.next=12,o;case 12:(s=t(a))&&s.data&&s.data.hasOwnProperty("ObjectId")?(u=ChipSoft.Core.itemViewModelCreator(this._state.settings.viewSettings),this._state.d(ChipSoft.Core.createViewDataModel(s,this._state.control.container,(function(e){u(e),c._modelCreator&&c._modelCreator(e)}),this._liveValueProviders)),this._metadata=this.createMetadata(s),this._state.postResultMessage(s.message),this._state.postStatus(s.status)):(this._state.d(ChipSoft.Core.createEmptyItemViewDataModel(this._state.control.container,this._state.settings.viewSettings)),this._metadata=null,this._state.postResultMessage(""),this._state.postStatus("")),"Success"===this._state.postStatus()?this._state.messagePanel.init(this._state.postResultMessageShow,this._state.postSuccessMessage(),"",null,ChipSoft.Client.MessagePanelType.Success,ChipSoft.Client.IconType.Check,!0):this._state.messagePanel.init(!0,"Validatiefouten",this._state.postResultMessage(),null,ChipSoft.Client.MessagePanelType.Error,ChipSoft.Client.IconType.Cancel,!0),this._state.control.endLoading(this._state.control.loadingId),r.next=22;break;case 18:r.prev=18,r.t0=r.catch(3),ChipSoft.PageManager.logError(r.t0),this._state.control.isError(!0);case 22:return r.abrupt("return",!1);case 23:case"end":return r.stop()}}),r,this,[[3,18]])})))},this._state=t}return _createClass(e,[{key:"getDataOnInit",get:function(){return this._getDataOnInit},set:function(e){this._getDataOnInit=e}},{key:"getDataOnInitNotConnectedTo",get:function(){return this._getDataOnInitNotConnectedTo}},{key:"getDataOnInitConditions",get:function(){return this._getDataOnInitConditions}},{key:"modelCreator",get:function(){return this._modelCreator},set:function(e){this._modelCreator=e}},{key:"liveValueProviders",get:function(){return this._liveValueProviders||(this._liveValueProviders=new ChipSoft.Core.LiveValueProviders),this._liveValueProviders}},{key:"updateWithObjectId",value:function(e,t,n){var r=this;return function(i){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.updateInternal((function(t){return e(t,i)}),t,n));case 1:case"end":return r.stop()}}),r,this)})))}}},{key:"setInitialAction",value:function(e,t,n){this._initialAction={action:e,viewData:t,dataCallback:n}}},{key:"setRefreshAction",value:function(e,t,n){this._refreshActionCallback={action:e,viewData:t,dataCallback:n}}},{key:"setSaveAction",value:function(e,t,n){this._saveActionCallback={action:e,viewData:t,dataCallback:n}}},{key:"dispose",value:function(){}},{key:"refreshInternal",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){var t;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=this._refreshActionCallback)){e.next=4;break}return e.next=4,this.updateInternal(t.action,t.viewData,t.dataCallback);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"clearInternal",value:function(){this._state.d(ChipSoft.Core.createEmptyItemViewDataModel(this._state.control.container,this._state.settings.viewSettings)),this._metadata=null,this._state.postResultMessage(""),this._state.postStatus("");var e=!1;this._state.settings.viewSettings&&"HideView"===this._state.settings.viewSettings.noDataPolicy&&(this._state.settings.viewSettings.noDataText||(e=!0)),e?this._state.control.hide():this._state.control.show()}},{key:"getView",value:function(e,t){if(!t)return null;for(var n=0;n<e.viewData.views.length;n++){var r=e.viewData.views[n];if(r.definition.ViewVersion.ClassId===t.ClassId&&r.definition.ViewVersion.Mode===t.Mode&&r.definition.ViewVersion.Version===t.Version&&(!r.definition.ViewVersion.Uri&&!r.definition.ViewVersion.Uri||r.definition.ViewVersion.Uri&&t.Uri&&r.definition.ViewVersion.Uri.toLowerCase()===t.Uri.toLowerCase()))return r}return null}},{key:"getOriginalValue",value:function(e,t){return e.Prefix?e.Prefix+":"+e.Input:t?t+":"+e.Value:e.Value}},{key:"createMetadata",value:function(e){var t=e.viewId,o=this.getView(e,t);if(!o)throw new Error("view not found: "+t.Uri);var s=new ChipSoft.Utilities.ExchangeUtil(e.data),u=new r;u.mode=0===e.data.ObjectId.ObjectIds.length?n.NewObject:n.EditObject,u.objectId=e.data.ObjectId,u.viewId=t;for(var c=0;c<o.definition.Fields.Items.length;c++){var l=o.definition.Fields.Items[c],h=this.getFieldPathFrom(this.getOriginalValue(l.FieldPath,"field"));if(h.isHiXFieldPath)for(var d=u.fields,f=h.fieldPath.split("."),p=0;p<f.length;p++){var v=f.slice(0,p+1).join("."),g=s.getField(e.data,v);if(!g.Value)throw new Error("Field '"+v+"' has no value.");if("Collection"===g.Value.ValueType)throw new Error("Collection fields are not supported. path: "+v);var _=p===f.length-1,m=f[p];if(_)if("Object"===g.Value.ValueType){var w=g.Value.Value;if(!w)throw new Error("Expected an object field value at field path '"+v+"'.");if(d[m]){var C=d[m];if(!(C instanceof a))throw new Error("Expected an object value at field path: "+v);if(!ChipSoft.Core.areObjectIdsEqual(C.objectId,w.ObjectId))throw new Error("Multiple objectIds for field path '"+v+"' objectId1: "+C.objectId+"objectId2: "+w.ObjectId)}else{var b=new a;b.name=m,b.valueType=g.Value.ValueType,b.objectId=w.ObjectId,b.mode=n.None,d[m]=b}}else{var I=new i;I.name=m,I.valueType=g.Value.ValueType,d[m]=I}else{if("Object"!==g.Value.ValueType)throw new Error("Expected an object field at field path '"+v+"'.");var x=g.Value.Value;if(!x)throw new Error("Expected an object field value at field path '"+v+"'.");if(d[m]){var y=d[m];if(!(y instanceof a))throw new Error("Expected an object value at field path: "+v);d=y.fields}else{var k=new a;k.name=m,k.valueType=g.Value.ValueType,k.objectId=x.ObjectId,k.mode=0===x.ObjectId.ObjectIds.length?n.NewObject:n.EditObject,d[m]=k,d=k.fields}}}}return u}},{key:"getFieldPathFrom",value:function(e){var t={isHiXFieldPath:!1,fieldPath:"",isSingleFieldPath:!1};if(!e)return t;for(var n=e.split("."),r=[],i=0;i<n.length;i++){var a=n[i],o=a.indexOf(":");if(0===o)r.push(a.substring(1));else if(o>=0){if("field"!==a.substring(0,o))return t;r.push(a.substring(o+1))}else r.push(a)}return{isHiXFieldPath:!0,fieldPath:r.join("."),isSingleFieldPath:1===r.length}}},{key:"tryGetValue",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].Name===t)return e[n];return null}},{key:"getMetadataField",value:function(e,t){for(var n=e.fields,r=t.split("."),i=0;i<r.length;i++){var o=r[i],s=i===r.length-1,u=n[o];if(!u)throw new Error("Metadata field '"+r.slice(0,i+1).join(".")+"' not found.");if(s)return u;if(!(u instanceof a))throw new Error("Expected an object metadata field at fieldpath '"+r.slice(0,i+1).join(".")+"'.");n=u.fields}throw new Error("Metadata for field '"+t+"' was not found.")}},{key:"storeValue",value:function(e,t,r,i){for(var o=r.split("."),s=e,u=0,c=o.length;u<c;u++){var l=o[u];if(u===c-1)s.Fields.Items.push(i);else{var h=this.tryGetValue(s.Fields.Items,l);if(h){if("Object"!==h.ValueType)throw new Error("Expected an object field at: "+o.slice(0,u+1).join("."));s=h.Value}else{var d=this.getMetadataField(t,o.slice(0,u+1).join("."));if(!(d instanceof a))throw new Error("Expected an object metadata field at: "+o.slice(0,u+1).join("."));var f={ClassId:d.objectId.ClassId,Mode:"None",Fields:{IgnoreCase:!0,Items:[]}};d.mode===n.EditObject?f.Mode="EditObject":d.mode===n.NewObject&&(f.Mode="NewObject");var p={Name:l,ValueType:"Object",Value:f};s.Fields.Items.push(p),s=f}}}}}]),e}())}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ItemUpdateViewModel",["ChipSoft/ViewModelHelper/ItemUpdateHelper","ChipSoft/ViewModelHelper/ItemUpdateState"],(function(e,t){var n,r;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){e("ItemUpdateViewModel",function(e){_inherits(i,ChipSoft.Core.ViewModel);var t=_createSuper(i);function i(e,a){var o;return _classCallCheck(this,i),(o=t.call(this)).settings=e,o.isError=ko.observable(!1),o.isNotError=ko.pureComputed((function(){return!o.isError()}),_assertThisInitialized(o)),o.d=ko.observable(ChipSoft.Core.createEmptyItemViewDataModel(_assertThisInitialized(o),o.settings.viewSettings)),o.messagePanel=new ChipSoft.Client.MessagePanel,o.postResultMessage=ko.observable(""),o.postStatus=ko.observable(""),o.postSuccessMessage=ko.observable("Object was saved"),o.postResultMessageShow=ko.observable(!0),o.hideViewOnSuccessfulPost=!1,o.helper=new n.ItemUpdateHelper(new r.ItemUpdateState(new r.ItemUpdateStateControl(_assertThisInitialized(o),o.service,{startLoading:o.startLoading,endLoading:o.endLoading},{show:o.show,hide:o.hide},o.isError),o.settings,o.d,o.messagePanel,o.postResultMessage,o.postStatus,o.postSuccessMessage,o.postResultMessageShow,o.hideViewOnSuccessfulPost)),o.settings=e,a&&(o.uniqueId=a.uniqueId,o.clientId=a.uniqueId,o.requestInfo=a.requestInfo,o.templateName=a.templateName),o}return _createClass(i,[{key:"init",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.configure(),this.initialized(!0),e.next=4,this.helper.init();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"registerFormActionHandler",value:function(e){if(this._actionHandler)throw new Error("Action handler is already registered");this._actionHandler=e,ChipSoft.PageManager.registerFormActionHandler(this)}},{key:"isFormActionSupported",value:function(e){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._actionHandler){t.next=4;break}return t.next=3,this._actionHandler.isFormActionSupported(e);case 3:return t.abrupt("return",t.sent);case 4:return t.abrupt("return",!1);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"canExecuteFormAction",value:function(e,t){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._actionHandler){n.next=4;break}return n.next=3,this._actionHandler.canExecuteFormAction(e,t);case 3:return n.abrupt("return",n.sent);case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"executeFormAction",value:function(e,t){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._actionHandler){n.next=4;break}return n.next=3,this._actionHandler.executeFormAction(e,t);case 3:return n.abrupt("return",n.sent);case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"onRefresh",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.helper.refresh();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"disposeInternal",value:function(){_get(_getPrototypeOf(i.prototype),"disposeInternal",this).call(this),this.helper.dispose()}},{key:"save",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.helper.save();case 2:case"end":return e.stop()}}),e,this)})))}}]),i}())}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ItemViewModel",["ChipSoft/ViewModelHelper/ItemHelper","ChipSoft/ViewModelHelper/ItemState"],(function(e,t){var n,r;t&&t.id;return{setters:[function(e){n=e},function(e){r=e}],execute:function(){e("ItemViewModel",function(e){_inherits(i,ChipSoft.Core.ViewModel);var t=_createSuper(i);function i(e,a){var o;return _classCallCheck(this,i),(o=t.call(this)).settings=e,o.isError=ko.observable(!1),o.isNotError=ko.pureComputed((function(){return!o.isError()}),_assertThisInitialized(o)),o.d=ko.observable(ChipSoft.Core.createEmptyItemViewDataModel(_assertThisInitialized(o),o.settings.viewSettings)),o.messagePanel=new ChipSoft.Client.MessagePanel,o.helper=new n.ItemHelper(new r.ItemState(new r.ItemStateControl(_assertThisInitialized(o),o.service,{startLoading:o.startLoading,endLoading:o.endLoading},{show:o.show,hide:o.hide},o.isError),o.settings,o.d,o.messagePanel)),o.settings=e,a&&(o.uniqueId=a.uniqueId,o.clientId=a.uniqueId,o.requestInfo=a.requestInfo,o.templateName=a.templateName),o}return _createClass(i,[{key:"init",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.configure(),this.initialized(!0),e.next=4,this.helper.init();case 4:case"end":return e.stop()}}),e,this)})))}},{key:"registerFormActionHandler",value:function(e){if(this._actionHandler)throw new Error("Action handler is already registered");this._actionHandler=e,ChipSoft.PageManager.registerFormActionHandler(this)}},{key:"isFormActionSupported",value:function(e){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._actionHandler){t.next=4;break}return t.next=3,this._actionHandler.isFormActionSupported(e);case 3:return t.abrupt("return",t.sent);case 4:return t.abrupt("return",!1);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"canExecuteFormAction",value:function(e,t){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._actionHandler){n.next=4;break}return n.next=3,this._actionHandler.canExecuteFormAction(e,t);case 3:return n.abrupt("return",n.sent);case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"executeFormAction",value:function(e,t){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._actionHandler){n.next=4;break}return n.next=3,this._actionHandler.executeFormAction(e,t);case 3:return n.abrupt("return",n.sent);case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"onRefresh",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.helper.refresh();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"disposeInternal",value:function(){_get(_getPrototypeOf(i.prototype),"disposeInternal",this).call(this),this.helper.dispose()}}]),i}())}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ListState",[],(function(e,t){t&&t.id;return{setters:[],execute:function(){e("ListState",_createClass((function e(t,n,r,i){_classCallCheck(this,e),this.control=t,this.settings=n,this.d=r,this.messagePanel=i}))),e("ListStateControl",_createClass((function e(t,n,r,i,a,o){_classCallCheck(this,e),this.container=t,this.service=n,this.pager=r,this.startLoading=i.startLoading,this.endLoading=i.endLoading,this.loadingId=i.loadingId,this.show=a.show,this.hide=a.hide,this.isError=o})))}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ListHelper",[],(function(e,t){var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(t){var n=this;_classCallCheck(this,e),this._getDataOnInit=!0,this._getDataOnInitNotConnectedTo=[],this._getDataOnInitConditions=[],this._toHighlight=[],this._enableQueryHighlight=!0,this.init=function(){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function e(){var t,n;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._enableQueryHighlight&&this.initQueryHighlight(),!(this._getDataOnInit&&this._initialAction&&this._initialAction.action)){e.next=20;break}if(!(this._getDataOnInitNotConnectedTo.length>0)){e.next=10;break}t=0;case 4:if(!(t<this._getDataOnInitNotConnectedTo.length)){e.next=10;break}if(!ChipSoft.ClientConnectionManager.getConnectionProviderId(this._state.control.container.requestInfo.componentId,this._getDataOnInitNotConnectedTo[t])){e.next=7;break}return e.abrupt("return");case 7:t++,e.next=4;break;case 10:if(!(this._getDataOnInitConditions.length>0)){e.next=18;break}n=0;case 12:if(!(n<this._getDataOnInitConditions.length)){e.next=18;break}if(this._getDataOnInitConditions[n]()){e.next=15;break}return e.abrupt("return");case 15:n++,e.next=12;break;case 18:return e.next=20,this.updateInternal(this._initialAction.action,this._initialAction.viewData,this._initialAction.dataCallback);case 20:case"end":return e.stop()}}),e,this)})))},this.refresh=function(){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.refreshInternal());case 1:case"end":return e.stop()}}),e,this)})))},this.update=function(e,t,r){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",this.updateInternal(e,t,r));case 1:case"end":return n.stop()}}),n,this)})))},this.clear=function(){n.clearInternal()},this.updateCommand=function(e,t,r){return function(i,a,o,s){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function n(){var i;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){n.next=4;break}return i=s.objectId,n.next=4,this.updateInternal((function(t){return e(t,i)}),t,r);case 4:case"end":return n.stop()}}),n,this)})))}},this.provideConnectionWithCollectionReferenceCommand=function(e,t,r){return function(i,a,o,s){for(var u={ClassId:"",Locked:!0,Items:[]},c=n._state.d(),l=null,h=0;h<c.viewResult.item.length;h++){var d=c.viewResult.item[h];d.itemModel[ChipSoft.Core.DefaultItemNodeModelProperties.selected]()&&(t&&d.itemModel[ChipSoft.Core.DefaultItemNodeModelProperties.selected](!1),null===l?l=d.objectId.ClassId:l!==d.objectId.ClassId&&(l=""),u.Items.push(d.objectId))}r&&0===u.Items.length?r():(u.ClassId=l,ChipSoft.ClientConnectionManager.provide(n._state.control.container.requestInfo.componentId,e,new ChipSoft.Core.CollectionReferenceConnectionData(u)))}},this.getObjectIds=function(){for(var e=null,t={ClassId:null,Locked:!0,Items:[]},r=n._state.d(),i=0;i<r.viewResult.item.length;i++){var a=r.viewResult.item[i];t.Items.push(a.objectId),!e&&a.objectId&&a.objectId.ClassId?e=a.objectId.ClassId:e&&a.objectId&&a.objectId.ClassId&&e!==a.objectId.ClassId&&(e=null)}return t.ClassId=e,t},this.updateInternal=function(e,t,r,i){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function n(){var a,o,s,u,c,l,h,d,f,p,v=this;return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a=this._lastAction="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),this._state.control.isError(!1),this._state.messagePanel.isVisible(!1),!1!==(null==i?void 0:i.showLoader)&&this._state.control.startLoading(this._state.control.loadingId),n.prev=4,n.next=7,e(this._state.control.service);case 7:if(o=n.sent,a===this._lastAction){n.next=11;break}return ChipSoft.PageManager.logVerbose("componentActionRequest ".concat(a," is superseded by ").concat(this._lastAction)),n.abrupt("return",!1);case 11:if(s=!1,(u=t(o))&&u.data&&u.data.hasOwnProperty("ClassId")&&u.data.hasOwnProperty("Items")&&(s=!0),!r){n.next=19;break}if(!(c=r(o))){n.next=19;break}return n.next=19,c;case 19:s?((l=this._state.control.pager())instanceof ChipSoft.Core.VirtualFixedSizePager?l.viewData(u):l&&l.update(u.data),h=ChipSoft.Core.listViewModelCreator(this._state.settings.viewSettings),d=ChipSoft.Core.createViewDataModel(u,this._state.control.container,(function(e){h(e),v._modelCreator&&v._modelCreator(e)}),this._liveValueProviders),this._state.d(d),this.highlightRow(this._toHighlight),f=!1,this._state.settings.viewSettings&&"HideView"===this._state.settings.viewSettings.noDataPolicy&&!0===d.viewResult.attr[ChipSoft.Views.ViewResultNodeAttributes.empty]&&(this._state.settings.viewSettings.noDataText||(f=!0)),f?this._state.control.hide():this._state.control.show()):this.clearInternal(),n.next=28;break;case 22:n.prev=22,n.t0=n.catch(4),ChipSoft.PageManager.logError(n.t0),(p=this._state.control.pager())instanceof ChipSoft.Core.VirtualFixedSizePager?p.viewData(null):p&&p.update(null),this._state.control.isError(!0);case 28:return!1!==(null==i?void 0:i.showLoader)&&this._state.control.endLoading(this._state.control.loadingId),n.abrupt("return",!1);case 30:case"end":return n.stop()}}),n,this,[[4,22]])})))},this._state=t}return _createClass(e,[{key:"autoRefreshTimeout",get:function(){return this._autoRefreshTimeout},set:function(e){this._autoRefreshTimeout=e}},{key:"getDataOnInit",get:function(){return this._getDataOnInit},set:function(e){this._getDataOnInit=e}},{key:"getDataOnInitNotConnectedTo",get:function(){return this._getDataOnInitNotConnectedTo}},{key:"getDataOnInitConditions",get:function(){return this._getDataOnInitConditions}},{key:"enableQueryHighlight",get:function(){return this._enableQueryHighlight},set:function(e){this._enableQueryHighlight=e}},{key:"modelCreator",get:function(){return this._modelCreator},set:function(e){this._modelCreator=e}},{key:"liveValueProviders",get:function(){return this._liveValueProviders||(this._liveValueProviders=new ChipSoft.Core.LiveValueProviders),this._liveValueProviders}},{key:"updateWithObjectId",value:function(e,t,n){var r=this;return function(i){return __awaiter(r,void 0,void 0,_regeneratorRuntime().mark((function r(){return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",this.updateInternal((function(t){return e(t,i)}),t,n));case 1:case"end":return r.stop()}}),r,this)})))}}},{key:"setInitialAction",value:function(e,t,n){this._initialAction={action:e,viewData:t,dataCallback:n}}},{key:"setRefreshAction",value:function(e,t,n){this._refreshActionCallback={action:e,viewData:t,dataCallback:n}}},{key:"dispose",value:function(){this._autoRefreshTimer&&clearTimeout(this._autoRefreshTimer)}},{key:"highlightRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:667;if(!e)throw new Error("Invalid id");var r,i=this._state.d();r=this.isObjectIdArray(e)?e:[e],i.viewResult&&i.viewResult.item.forEach((function(e,i){for(var a=!1,o=0;o<r.length;o++)if(ChipSoft.Core.areObjectIdsEqual(e.objectId,r[o])){a=!0;break}if(a){var s=0;e.itemModel.highlighted(!0);var u=setInterval((function(){e.itemModel.highlighted(!e.itemModel.highlighted()),s>t&&(clearInterval(u),e.itemModel.highlighted(!0)),s++}),n)}}))}},{key:"setExpandBehavior",value:function(e,t){var n=this,r=this._modelCreator;this._modelCreator=function(i){r&&r(i),i.modelType===ChipSoft.Core.ViewDataModelCreatorType.Item&&i.setModelProperty(ChipSoft.Core.DefaultItemNodeModelProperties.customExpandFunction,(function(r){if(e)for(var i=n._state.d(),a=0;a<i.viewResult.item.length;a++){var o=i.viewResult.item[a];o!==r&&o.itemModel[ChipSoft.Core.DefaultItemNodeModelProperties.expanded](!1)}t&&t(r)}),!1)}}},{key:"expandRow",value:function(e){if(!e)throw new Error("Invalid id");var t,n=this._state.d();t=this.isObjectIdArray(e)?e:[e],n.viewResult&&n.viewResult.item.forEach((function(e,n){for(var r=!1,i=0;i<t.length;i++)if(ChipSoft.Core.areObjectIdsEqual(e.objectId,t[i])){r=!0;break}e.itemModel.expanded(r)}))}},{key:"setSelectBehavior",value:function(e,t){var n=this,r=this._modelCreator;this._modelCreator=function(i){r&&r(i),i.modelType!==ChipSoft.Core.ViewDataModelCreatorType.View||i.path||(i.setModelProperty(ChipSoft.Core.DefaultListModelProperties.selectable,!0),i.setModelProperty(ChipSoft.Core.DefaultListModelProperties.multiselect,!e),i.setModelProperty(ChipSoft.Core.DefaultListModelProperties.singleselect,e)),i.modelType===ChipSoft.Core.ViewDataModelCreatorType.Item&&i.setModelProperty(ChipSoft.Core.DefaultItemNodeModelProperties.customSelectFunction,(function(r){var i=n._state.d();if(e){for(var a=0;a<i.viewResult.item.length;a++){var o=i.viewResult.item[a];o!==r&&o.itemModel[ChipSoft.Core.DefaultItemNodeModelProperties.selected](!1)}r.itemModel[ChipSoft.Core.DefaultItemNodeModelProperties.selected](!0)}t&&t(r)}),!1)}}},{key:"selectRow",value:function(e){if(!e)throw new Error("Invalid id");var t,n=this._state.d();t=this.isObjectIdArray(e)?e:[e],n.viewResult&&n.viewResult.item.forEach((function(e,n){for(var r=!1,i=0;i<t.length;i++)if(ChipSoft.Core.areObjectIdsEqual(e.objectId,t[i])){r=!0;break}e.itemModel.selected(r)}))}},{key:"isObjectIdArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"initQueryHighlight",value:function(){var e;try{e=ChipSoft.Client.parseQueryParameters()}catch(e){return void ChipSoft.PageManager.logError(e)}for(var t in e)if(e.hasOwnProperty(t)&&t.startsWith("$hl_")){var n=t.substr(4),r=void 0;try{r=JSON.parse(e[t])}catch(e){ChipSoft.PageManager.logError(e)}if(r&&r.length)for(var i=0;i<r.length;i++){var a=r[i];if(a&&a.length){var o={ClassId:n,ObjectIds:a};this._toHighlight.push(o)}}}}},{key:"refreshInternal",value:function(e){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function t(){var n;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=this._refreshActionCallback)){t.next=4;break}return t.next=4,this.updateInternal(n.action,n.viewData,n.dataCallback,e);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"clearInternal",value:function(){var e=this._state.control.pager();e instanceof ChipSoft.Core.VirtualFixedSizePager?e.viewData(null):e&&e.update(null),this._state.d(ChipSoft.Core.createEmptyListViewDataModel(this._state.control.container,this._state.settings.viewSettings)),this.highlightRow(this._toHighlight);var t=!1;this._state.settings.viewSettings&&"HideView"===this._state.settings.viewSettings.noDataPolicy&&(this._state.settings.viewSettings.noDataText||(t=!0)),t?this._state.control.hide():this._state.control.show()}}]),e}(),e("ListHelper",n)}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ViewModelHelper",[],(function(e,t){var n;t&&t.id;return{setters:[],execute:function(){n=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"validateObjectFieldPathValueNotEmpty",value:function(e,t){if(!e)return!1;var n=new ChipSoft.Utilities.ExchangeUtil(e).getField(e,t);if(!n||!n.Value)return!1;if("Object"===n.Value.ValueType){var r=n.Value.Value;return r&&r.ObjectId&&r.ObjectId.ObjectIds&&r.ObjectId.ObjectIds.length>0}if("Collection"===n.Value.ValueType){var i=n.Value.Value;return i&&i.Items&&i.Items.length>0}return!!n.Value.Value}},{key:"createFixedSizePageOptions",value:function(e){return{$type:"ChipSoft.PlatformServices.Shared.Protocol.FixedSizePageOptions, ChipSoft.PlatformServices.Shared",PageDirection:(null==e?void 0:e.direction)?e.direction:"Forward",PageSize:(null==e?void 0:e.pageSize)?e.pageSize:20,LastObjectId:(null==e?void 0:e.lastObjectId)?e.lastObjectId:null}}},{key:"withObjectIdCondition",value:function(e,t){return function(n){for(var r=!0,i=0;i<t.length;i++)if(!t[i]()){r=!1;break}if(r)return e(n)}}},{key:"whenConnectedCondition",value:function(e,t,n){return function(){return!ChipSoft.ClientConnectionManager.hasConnectedProviders(e.requestInfo.componentId,t)||n()}}},{key:"registerObjectIdConnectionCallback",value:function(e,t){for(var n=this,r=arguments.length,i=new Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];ChipSoft.ClientConnectionManager.registerConsumerCallback(e.requestInfo.componentId,t,(function(e){return __awaiter(n,void 0,void 0,_regeneratorRuntime().mark((function t(){var n,r;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e instanceof ChipSoft.Core.ObjectIdConnectionData)){t.next=10;break}n=0;case 2:if(!(n<i.length)){t.next=10;break}if(!((r=i[n](e.objectId))instanceof Promise)){t.next=7;break}return t.next=7,r;case 7:n++,t.next=2;break;case 10:case"end":return t.stop()}}),t)})))}))}}]),e}(),e("ViewModelHelper",n),n,n.defaultListSelectCommand=function(e){return function(t,n,r,i){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e){t.next=9;break}if(!e.select||!e.select.nav){t.next=9;break}if(!(i instanceof ChipSoft.Views.ViewResultItemNode)){t.next=7;break}return t.next=5,ChipSoft.Client.handleViewCommandNavigation(r,e.select.nav,i);case 5:t.next=9;break;case 7:return t.next=9,ChipSoft.Client.handleViewCommandNavigation(r,e.select.nav);case 9:case"end":return t.stop()}}),t)})))}},n.navigateCommand=function(e){return function(t,n,r,i){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||!ChipSoft.Client.canNavigate(e)){t.next=8;break}if(!(i instanceof ChipSoft.Views.ViewResultItemNode)){t.next=6;break}return t.next=4,ChipSoft.Client.handleViewCommandNavigation(r,e,i);case 4:t.next=8;break;case 6:return t.next=8,ChipSoft.Client.handleViewCommandNavigation(r,e);case 8:case"end":return t.stop()}}),t)})))}},n.navigateOrProviderConnectionWithObjectIdCommand=function(e,t,n,r){return function(i,a,o,s){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function i(){var a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!t||!ChipSoft.Client.canNavigate(t)){i.next=10;break}if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){i.next=6;break}return i.next=4,ChipSoft.Client.handleViewCommandNavigation(o,t,s);case 4:i.next=8;break;case 6:return i.next=8,ChipSoft.Client.handleViewCommandNavigation(o,t);case 8:i.next=18;break;case 10:if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){i.next=18;break}if(a=s.objectId,!(null==r?void 0:r.useButtonLoader)){i.next=17;break}return i.next=15,e.withItemButtonLoader((function(){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,n,new ChipSoft.Core.ObjectIdConnectionData(a));case 1:case"end":return t.stop()}}),t)})))}),o);case 15:i.next=18;break;case 17:ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,n,new ChipSoft.Core.ObjectIdConnectionData(a));case 18:case"end":return i.stop()}}),i)})))}},n.navigateViewCommand=function(e){return function(t,n,r,i){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e&&e.active&&e.navigation&&ChipSoft.Client.canNavigate(e.navigation))){t.next=8;break}if(!(i instanceof ChipSoft.Views.ViewResultItemNode)){t.next=6;break}return t.next=4,ChipSoft.Client.handleViewCommandNavigation(r,e.navigation,i);case 4:t.next=8;break;case 6:return t.next=8,ChipSoft.Client.handleViewCommandNavigation(r,e.navigation);case 8:case"end":return t.stop()}}),t)})))}},n.navigateOrProviderConnectionWithObjectIdViewCommand=function(e,t,n,r){return function(i,a,o,s){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function i(){var a;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t&&t.active){i.next=2;break}return i.abrupt("return");case 2:if(!t.navigation||!ChipSoft.Client.canNavigate(t.navigation)){i.next=12;break}if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){i.next=8;break}return i.next=6,ChipSoft.Client.handleViewCommandNavigation(o,t.navigation,s);case 6:i.next=10;break;case 8:return i.next=10,ChipSoft.Client.handleViewCommandNavigation(o,t.navigation);case 10:i.next=20;break;case 12:if(!(s instanceof ChipSoft.Views.ViewResultItemNode)){i.next=20;break}if(a=s.objectId,!(null==r?void 0:r.useButtonLoader)){i.next=19;break}return i.next=17,e.withItemButtonLoader((function(){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,n,new ChipSoft.Core.ObjectIdConnectionData(a));case 1:case"end":return t.stop()}}),t)})))}),o);case 17:i.next=20;break;case 19:ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,n,new ChipSoft.Core.ObjectIdConnectionData(a));case 20:case"end":return i.stop()}}),i)})))}},n.provideConnectionWithObjectIdCommand=function(e,t){return function(n,r,i,a){if(a instanceof ChipSoft.Views.ViewResultItemNode){var o=a.objectId;ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,t,new ChipSoft.Core.ObjectIdConnectionData(o))}}},n.navigateDataCallback=function(e,t){return function(n){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function r(){var i,a,o,s,u;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(i=!0,!t||!t.validateResponse){r.next=11;break}a=0;case 3:if(!(a<t.validateResponse.length)){r.next=11;break}if((0,t.validateResponse[a])(n)){r.next=8;break}return i=!1,r.abrupt("break",11);case 8:a++,r.next=3;break;case 11:if(!i){r.next=20;break}if(!e){r.next=20;break}if(o=Object.assign({},e),(null==t?void 0:t.objectid)&&(s=t.objectid(n),"CurrentObject"===o.objectParameterType&&s&&s.ClassId&&o.navigationUrl&&(o.navigationUrl=ChipSoft.Client.addHiXObjectReferenceQueryParameter(o.navigationUrl,s,1))),(null==t?void 0:t.lastAction)&&(u=t.lastAction(n))&&o.navigationUrl&&(o.navigationUrl=ChipSoft.Client.addQueryParameter(o.navigationUrl,u.name,u.value,1)),!ChipSoft.Client.canNavigate(o)){r.next=20;break}return r.next=19,ChipSoft.Client.handleNavigation(o);case 19:return r.abrupt("return");case 20:(null==t?void 0:t.navigationDisabled)&&(null==t||t.navigationDisabled(n));case 21:case"end":return r.stop()}}),r)})))}},n.viewCommandDataCallback=function(e,t){return function(n){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function r(){var i,a,o,s,u;return _regeneratorRuntime().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&e.active){r.next=2;break}return r.abrupt("return");case 2:if(i=!0,!t||!t.validateResponse){r.next=13;break}a=0;case 5:if(!(a<t.validateResponse.length)){r.next=13;break}if((0,t.validateResponse[a])(n)){r.next=10;break}return i=!1,r.abrupt("break",13);case 10:a++,r.next=5;break;case 13:if(!i){r.next=22;break}if(!e.navigation){r.next=22;break}if(o=Object.assign({},e.navigation),(null==t?void 0:t.objectid)&&(s=t.objectid(n),"CurrentObject"===o.objectParameterType&&s&&s.ClassId&&o.navigationUrl&&(o.navigationUrl=ChipSoft.Client.addHiXObjectReferenceQueryParameter(o.navigationUrl,s,1))),(null==t?void 0:t.lastAction)&&(u=t.lastAction(n))&&o.navigationUrl&&(o.navigationUrl=ChipSoft.Client.addQueryParameter(o.navigationUrl,u.name,u.value,1)),!ChipSoft.Client.canNavigate(o)){r.next=22;break}return r.next=21,ChipSoft.Client.handleNavigation(o);case 21:return r.abrupt("return");case 22:(null==t?void 0:t.navigationDisabled)&&(null==t||t.navigationDisabled(n));case 23:case"end":return r.stop()}}),r)})))}},n.provideConnectionWithObjectIdDataCallback=function(e,t,n,r){return function(i){if(i){var a=n(i);if(r){var o=new ChipSoft.Utilities.ExchangeUtil(a).getField(a,r);o&&o.Value&&"Object"===o.Value.ValueType&&o.Value.Value&&ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,t,new ChipSoft.Core.ObjectIdConnectionData(o.Value.Value.ObjectId))}else ChipSoft.ClientConnectionManager.provide(e.requestInfo.componentId,t,new ChipSoft.Core.ObjectIdConnectionData(a.ObjectId))}}},n.refreshConnectionProviderDataCallback=function(e,t,n){return function(r){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark((function i(){var a,o,s,u;return _regeneratorRuntime().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(a=!0,!n||!n.validateResponse){i.next=11;break}o=0;case 3:if(!(o<n.validateResponse.length)){i.next=11;break}if((0,n.validateResponse[o])(r)){i.next=8;break}return a=!1,i.abrupt("break",11);case 8:o++,i.next=3;break;case 11:if(!a){i.next=18;break}if(!(s=ChipSoft.ClientConnectionManager.getConnectionProviderId(e.requestInfo.componentId,t))){i.next=18;break}if(!(u=ChipSoft.PageManager.getComponentById(s))||!u.viewModel){i.next=18;break}return i.next=18,u.viewModel.refresh();case 18:case"end":return i.stop()}}),i)})))}}}}})),ChipSoft.ModuleManager.register("ChipSoft/ViewModelHelper/ListViewModel",["ChipSoft/ViewModelHelper/ListHelper","ChipSoft/ViewModelHelper/ListState","ChipSoft/ViewModelHelper/ViewModelHelper"],(function(e,t){var n,r,i;t&&t.id;return{setters:[function(e){n=e},function(e){r=e},function(e){i=e}],execute:function(){e("ListViewModel",function(e){_inherits(a,ChipSoft.Core.ViewModel);var t=_createSuper(a);function a(e,i){var o;return _classCallCheck(this,a),(o=t.call(this)).settings=e,o.isError=ko.observable(!1),o.isNotError=ko.pureComputed((function(){return!o.isError()}),_assertThisInitialized(o)),o.d=ko.observable(ChipSoft.Core.createEmptyItemViewDataModel(_assertThisInitialized(o),o.settings.viewSettings)),o.messagePanel=new ChipSoft.Client.MessagePanel,o.pager=null,o.helper=new n.ListHelper(new r.ListState(new r.ListStateControl(_assertThisInitialized(o),o.service,(function(){return o.pager}),{startLoading:o.startLoading,endLoading:o.endLoading},{show:o.show,hide:o.hide},o.isError),o.settings,o.d,o.messagePanel)),o.settings=e,i&&(o.uniqueId=i.uniqueId,o.clientId=i.uniqueId,o.requestInfo=i.requestInfo,o.templateName=i.templateName),o}return _createClass(a,[{key:"init",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.configure(),this.registerCommand("commands.select",i.ViewModelHelper.defaultListSelectCommand(this.settings.viewSettings)),this.initialized(!0),e.next=5,this.helper.init();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"registerFormActionHandler",value:function(e){if(this._actionHandler)throw new Error("Action handler is already registered");this._actionHandler=e,ChipSoft.PageManager.registerFormActionHandler(this)}},{key:"isFormActionSupported",value:function(e){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function t(){return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._actionHandler){t.next=4;break}return t.next=3,this._actionHandler.isFormActionSupported(e);case 3:return t.abrupt("return",t.sent);case 4:return t.abrupt("return",!1);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"canExecuteFormAction",value:function(e,t){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._actionHandler){n.next=4;break}return n.next=3,this._actionHandler.canExecuteFormAction(e,t);case 3:return n.abrupt("return",n.sent);case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"executeFormAction",value:function(e,t){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function n(){return _regeneratorRuntime().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!this._actionHandler){n.next=4;break}return n.next=3,this._actionHandler.executeFormAction(e,t);case 3:return n.abrupt("return",n.sent);case 4:return n.abrupt("return",!1);case 5:case"end":return n.stop()}}),n,this)})))}},{key:"onRefresh",value:function(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark((function e(){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.helper.refresh();case 2:case"end":return e.stop()}}),e,this)})))}},{key:"disposeInternal",value:function(){_get(_getPrototypeOf(a.prototype),"disposeInternal",this).call(this),this.helper.dispose()}}]),a}())}}})); }viewmodelhelper_mds();